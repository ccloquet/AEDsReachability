<html> 
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" 	integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" 	crossorigin=""/>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" 			integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" 						crossorigin="anonymous"></script>
	<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" 			integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="   	crossorigin=""></script>

	<style>
		body
		{	
			background:black;
			font-family:"Lucida Sans";
		}
		#mapid
		{
			height: 100%;
		}
		h1
		{
			color:	white;
		}
	</style>
</head>
<body>
	<h1>AED 10 MIN REACHABILITY MAP – DEMO NOT FOR REAL USE – DATA &copy; OSM, 2018</h1>
	<div id="mapid"></div>
</body>

<script>
 
	var mymap = L.map('mapid').setView([50.84, 4.36], 13);

	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
	{
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
		maxZoom: 18,
	}).addTo(mymap);

	var myStyle = {
	    "color": "#ff3333",
	    "weight": 5,
	    "opacity": 0.25
	};

	var data_url = 'https://overpass-api.de/api/interpreter?data=%2F*%0AThis%20has%20been%20generated%20by%20the%20overpass-turbo%20wizard.%0AThe%20original%20search%20was%3A%0A%E2%80%9Cemergency%3Ddefibrillator%E2%80%9D%0A*%2F%0A%5Bout%3Ajson%5D%5Btimeout%3A25%5D%3B%0A%2F%2F%20gather%20results%0A%28%0A%20%20%2F%2F%20query%20part%20for%3A%20%E2%80%9Cemergency%3Ddefibrillator%E2%80%9D%0A%20%20node%5B%22emergency%22%3D%22defibrillator%22%5D%2850.7942172837094%2C4.255313873291016%2C50.89447985118614%2C4.497356414794922%29%3B%0A%20%20way%5B%22emergency%22%3D%22defibrillator%22%5D%2850.7942172837094%2C4.255313873291016%2C50.89447985118614%2C4.497356414794922%29%3B%0A%20%20relation%5B%22emergency%22%3D%22defibrillator%22%5D%2850.7942172837094%2C4.255313873291016%2C50.89447985118614%2C4.497356414794922%29%3B%0A%29%3B%0A%2F%2F%20print%20results%0Aout%20body%3B%0A%3E%3B%0Aout%20skel%20qt%3B';

	$.get(data_url, function(e)
	{
		var data = e.elements

		for (var i=0; i<data.length; ++i)
		{
			var marker = L.marker([data[i].lat, data[i].lon]).addTo(mymap);

			$.get( isoline_url(data[i].lat, data[i].lon),
			function(e)
			{
				L.geoJSON(e, {style: myStyle}).addTo(mymap);
			}, 'json');
			 break;
		}
	})

	function isoline_url(lat, lng)
	{
		return 'https://www.iso4app.net/rest/1.3/isoline.geojson?licKey=87B7FB96-83DA-4FBD-A312-7822B96BB143'
		+'&type=isochrone'
		+'&value=600'	// seconds
		+'&lat=' + lat
		+'&lng=' + lng
		+'&approx=50'
		+'&mobility=pedestrian'
		+'&speedType=normal'
		+'&reduceQueue=false'
		+'&avoidTolls=true'
		+'&restrictedAreas=false'
		+'&fastestRouting=true'
		+'&concavity=6'
		+'&buffering=3'
		+'&reqId=A57X';
	}

	// then... cache the isochrones, cache the AED data, smaller than 10 minutes (with a paying API key)

</script>
</html>
