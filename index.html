<html> 
<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" 	integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" 	crossorigin=""/>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" 			integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" 						crossorigin="anonymous"></script>
	<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" 			integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="   	crossorigin=""></script>
	
	<style>
		body
		{	
			background:black;
			font-family:"Lucida Sans";
		}
		#mapid
		{
			height: 90%;
		}
		h1
		{
			color:	white;
		}
	</style>
</head>
<body>
	<h1>AED <span id="timespan">3</span> MIN REACHABILITY MAP â€“ DEMO NOT FOR REAL USE. HELP MAPPING! <a target='_blank' href='https://www.openstreetmap.org'>WEB</a> / <a target='_blank' href='https://play.google.com/store/apps/details?id=io.mapsquare.osmcontributor&hl=fr'>APP</a>&nbsp;<i id='spin' style='display:none' class='fa fa-spin fa-spinner'></i></h1>
	<div id="mapid"></div>
</body>

<script>

	// initializes map
	var mymap = L.map('mapid').setView([50.84, 4.36], 13);

	L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 
	{
		attribution: 	'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.<br>2010 Population density: http://sedac.ciesin.columbia.edu/maps/services',
		maxZoom: 	18,
		zoom:		12
	}).addTo(mymap);

	/*L.tileLayer('https://cartocdn-gusc.global.ssl.fastly.net/duncansmith/api/v1/map/6448b3e05b1f0afbd28f9a9ed45019fc:1523283294850/0,1,2/{z}/{x}/{y}.png', 
	{
		attribution: 	'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>.<br>Population density: http://sedac.ciesin.columbia.edu/maps/services',
		maxZoom: 	18,
		zoom:		12
	}).addTo(mymap);*/

	var wmsLayer = L.tileLayer.wms('http://sedac.ciesin.columbia.edu/geoserver/wms?', {layers:'gpw-v3:gpw-v3-population-density_2000', opacity :.25, attribution:'r'}).addTo(mymap);

	L.control.scale().addTo(mymap);

	// style for the isochrones
	var myStyle = {
	    "color": 		"#00BB00",
	    "weight": 		2,
	    "fillOpacity": 	0.5
	};

	// get the AED data
	$('#spin').fadeIn()
	$.get('get_data.php?a='+Math.random(),  
	function(e)
	{
		$('#spin').fadeOut()

		var data = e.elements
		var isolines = e.areas

		// renders the AED data
		for (var i=0; i<data.length; ++i)
		{
			if ( (data[i].lat==null) | (data[i].lon == null ))
			{
				continue;
			}

			L.circleMarker([data[i].lat, data[i].lon], {radius:3,color:'red',fillColor:'red',opacity:1}).addTo(mymap);
			L.geoJSON(isolines[i], {style: myStyle}).addTo(mymap);	// isochrone
		}
		
	}, 'json')

	// then...
	// do not use the OSM community server
	// keep it simple...
	// ...

</script>
</html>
